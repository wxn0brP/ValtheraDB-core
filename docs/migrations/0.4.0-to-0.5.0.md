# Przewodnik migracji z 0.4.0 do 0.5.0

Wersja 0.5.0 wprowadza znaczące zmiany w API (Breaking Changes), mające na celu ujednolicenie sposobu wywoływania metod oraz poprawę czytelności kodu.

## 1. Zmiana sygnatur metod w `ValtheraClass`

Największą zmianą jest przejście z argumentów pozycyjnych na jeden obiekt zapytania (Query Object) dla większości metod w klasie `ValtheraClass`.

### Przykład: `find`

**Przed (0.4.0):**
```typescript
db.find(collection, search, dbFindOpts, findOpts, context);
```

**Po (0.5.0):**
```typescript
db.find({
  collection: "users",
  search: { name: "John" },
  dbFindOpts: { limit: 10 },
  findOpts: { select: ["name", "email"] },
  context: { userRole: "admin" }
});
```

Dotyczy to metod: `add`, `find`, `findOne`, `update`, `updateOne`, `remove`, `removeOne`, `updateOneOrAdd`, `toggleOne`.

## 2. Zmiana typów zwracanych

W poprzednich wersjach, metody takie jak `update` czy `remove` zwracały wartość logiczną `boolean` informującą o sukcesie operacji. W wersji 0.5.0 metody te zwracają zmodyfikowane lub usunięte obiekty.

- `update` / `remove` -> Zwracają tablicę zmodyfikowanych/usuniętych obiektów (lub `null`).
- `updateOne` / `removeOne` / `toggleOne` -> Zwracają zmodyfikowany/usunięty obiekt (lub `null`).
- `updateOneOrAdd` -> Zwraca zmodyfikowany lub nowo dodany obiekt.

## 3. Zmiana nazwy `CollectionManager` na `Collection`

Klasa służąca do zarządzania konkretną kolekcją zmieniła nazwę. Metoda `db.c(name)` teraz zwraca instancję klasy `Collection`.

**Przed (0.4.0):**
```typescript
import { CollectionManager } from "@wxn0brp/db-core";
const users = db.c<User>("users"); // Zwraca CollectionManager
```

**Po (0.5.0):**
```typescript
import { Collection } from "@wxn0brp/db-core";
const users = db.c<User>("users"); // Zwraca Collection
```

### Uwaga dotycząca metod `Collection`
Metody wywoływane na obiekcie kolekcji (np. `users.find(...)`) **nadal przyjmują argumenty pozycyjne** dla Twojej wygody, ale ich typy zwracane uległy zmianie zgodnie z punktem 2.

## 4. Nowy styl eksportów

Zmieniono sposób eksportowania elementów biblioteki, co jest zmianą głównie wewnętrzną, ale może wpłynąć na importy, jeśli korzystałeś z głębokich ścieżek dostępu. Zalecane jest korzystanie z głównego punktu wejścia:

```typescript
export {
  CustomFileCpu,
  createMemoryValthera,
  ValtheraClass,
  Collection, // Nowa nazwa
  // ... pozostałe
} from "@wxn0brp/db-core";
```
